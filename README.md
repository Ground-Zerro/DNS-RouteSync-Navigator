## DNS-RouteSync-Navigator


**Основные функции:** Скрипт представляет собой DNS masq сервер, который умеет добавлять на роутере статические маршруты для IP-адресов указанных пользователем доменов, для перенаправления к ним траффика через VPN подключение.
- Создано в первую очередь для роутеров Keenetic младших моделей с малым количеством памяти и без USB порта.

**Функции:**
- Принимает DNS запросы от клиентов, разрешает их IP-адрес используя вышестоящий DNS сервер.
- Проверяет полученное DNS имя на соответствие фильтру доменов, указанному в конфигурационном файле.
- При обнаружении совпадения DNS имени с фильтром, посредством Telnet или SSH добавляет на роутере статический маршрут для перенаправления трафика к IP-адресу домена через указанное пользователем VPN соединение.
- Фильтрация происходит по полному либо частичному соответствию вышестоящего домена. Например если в фильтре указано "ru" то для всех доменов RU зоны будут добавляться статические маршруты, или если в фильтре указанно - "mail.ru" то маршруты будут добавляться для него и всех остальных доменов заканчивающихся на ".mail.ru".


**Зависимости:** Для работы DNS-RouteSync-Navigator необходимо наличие следующих библиотек Python:
- telnetlib3
- configparser
- dnslib
- asyncssh

*Не забудьте установить их перед запуском:*
```
pip3 install -r requirements.txt
```

**Использование:**

Добавьте нового пользователя в роутере и разрешите ему досутп по SSH или Telnet.

Настройте в роутере любое, удобное вам, VPN подключение и дайте ему более-менее осмысленное название.

Узнайте "id" этого VPN подключения, для этого:
- зайдите и авторизируйтесь в админке роутера (обычно - 192.168.1.1),
- добавьте букву "а" после адреса роутера (было: "http://192.168.1.1/dashboard", стало: "http://192.168.1.1/a"),
- в поле "Command" наберите "show interface" и нажмите Enter,
- найдите ваше VPN соединение по его названию, которые вы осмысленно задали в самом начале ;),
- ниже имени будет "id" соединения, его и нужно вписать в строку "eth_id" файла config.ini.


Заполните конфигурационный файл config.ini, указав ВСЕ параметры.

В текстовый файл, указанный вами в config.ini, внесите доменные имена, для которых требуется перенаправление трафика.

Установите на своем роутере или ПК IP адрес машины с запущенным DNS-RouteSync-Navigator в качестве основного DNS сервера.

Скрип будет слушать DNS запросы и закидывать в роутер статические маршруты для перенаправления через VPN соединение трафика к доменным именам, указанным в фильтре.



#### Протестировано в Windows 11


**От автора:** Скрипт разработан в качестве "proof of concept" и представляет собой логическое продолжение проекта [DomainMapper](https://github.com/Ground-Zerro/DomainMapper). Главной целью является предоставление альтернативы OPKG пакетам на роутерах Keenetic младших моделей, не поддерживающих установку entware.
